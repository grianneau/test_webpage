(()=>{"use strict";var t,e,s,i={7581:(t,e,s)=>{var i=s(5622),r=s.n(i),n=s(8614),o=s(2357),a=s.n(o),h=s(3818),l=s(6551),c=s(2946),d=s(4189);class u{constructor(t){this._data=t.data,this._wait=t.wait||new Int32Array(new p(8))}static from(t){return new u(t)}to(){return{data:this._data,wait:this._wait}}enqueue(t){let e=Atomics.load(this._wait,0),s=Atomics.load(this._wait,1);return e?e--:e=this._data.length,e!=s?(Atomics.store(this._data,s++,t),Atomics.store(this._wait,1,s),Atomics.notify(this._wait,1,1),1):0}enqueueAll(t){let e=Atomics.load(this._wait,0),s=Atomics.load(this._wait,1);var i;for(e?e--:e=this._data.length,i=0;e!=s&&i<t.length;i++)Atomics.store(this._data,s++,t[i]);return i>0&&(Atomics.store(this._wait,1,s),Atomics.notify(this._wait,1,1)),i}wait(){let t=Atomics.load(this._wait,0),e=Atomics.load(this._wait,1);for(;t==e;)Atomics.wait(this._wait,1,e),e=Atomics.load(this._wait,1)}dequeue(){this.wait();let t=Atomics.load(this._wait,0),e=Atomics.load(this._data,t++);return Atomics.store(this._wait,0,t),Atomics.notify(this._wait,0,1),e}dequeueSome(t,e,s){if(0==t)return 0;this.wait();let i=Atomics.load(this._wait,0),r=Atomics.load(this._wait,1);var n;for(n=0;i!=r&&s<t;n++)e[s++]=Atomics.load(this._data,i++),r>=this._data.length&&(r=0);return Atomics.store(this._wait,0,i),Atomics.notify(this._wait,0,1),n}isEmpty(){return Atomics.load(this._wait,0)==Atomics.load(this._wait,1)}}const p="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;class f extends n.EventEmitter{constructor(t={}){super(),this.queue=u.from(t.queue||{data:new Uint8Array(new g(1024))}),this.meta=t.meta||new Int32Array(new g(4)),t.meta||(this.length=-1),this.pos=0,this.blocking=!0}static from(t){return new f(t)}to(){return{queue:this.queue.to(),meta:this.meta}}get length(){return Atomics.load(this.meta,0)}set length(t){Atomics.store(this.meta,0,t)}read(t,e,s,i){if(s>t.length&&(s=t.length),this.queue.isEmpty()){if(e>0)return 0;if(!this.blocking)throw{errno:35,code:"EAGAIN"}}if(this.length>=0&&this.pos>=this.length)return 0;var r=this.queue.dequeueSome(s,t,e);return r>0&&(this.length>=0&&(r=Math.min(this.length-this.pos,r)),this.pos+=r,this.emit("data",t.slice(e,r))),r}write(t){let e=this.queue.enqueueAll(t);return this.pos+=e,e}end(){this.length=this.pos,this.queue.enqueue(0)}reset(){this.length=-1,this.pos=0,this.blocking=!0}}const g="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;class m extends n.EventEmitter{constructor(t){super(),this.core=t,this.fds=[],this.stdin_fl=0,this.termios={flags:[258,3,0,10],win:this.defaultWindow()},this.core.on("stream:out",(t=>{this.fds.includes(t.fd)&&this.emit("data",t.data)})),this.debug=()=>{}}to(){return{termios:{win:this.termios.win}}}makeTty(t){this.core.wasi.FD_MAP.get(t).filetype=2,this.core.wasi.FD_MAP.get(t).rights.base&=~BigInt(36)}write(t){this.core.stdin.write(t)}fd_fdstat_set_flags(t,e){return this.debug(`fdstat_set_flags(${t}, ${e})\n`),0===t&&(this.stdin_fl=e,this.core.stdin.blocking=!(4&e)),0}fd_fdstat_get(t,e){var s=this.core.wasi.wasiImport.fd_fdstat_get(t,e);return 0===t&&this.core.proc.mem.setUint16(e+2,this.stdin_fl,!0),s}defaultWindow(){var t=new Uint16Array(new SharedArrayBuffer(4));return t[0]=24,t[1]=80,t}get overrideImport(){return v(this,["fd_fdstat_get","fd_fdstat_set_flags"])}get import(){return v(this,["tcgetattr","tcsetattr","tgetent"])}get extlib(){return v(this,["tty_ioctl"])}tcgetattr(t,e){this.debug(`tcgetattr(${t}, ${e})`);let s=this.core.proc.mem;return this.termios.flags.forEach(((t,i)=>{s.setUint32(e+4*i,t,!0)})),s.setUint8(e+16+1+5,0),s.setUint8(e+16+1+6,1),0}tcsetattr(t,e,s){this.debug(`tcsetattr(${t}, ${e}, ${s})`);let i=this.core.proc.mem,r=w(4).map((t=>i.getUint32(s+4*t,!0))),n=w(32).map((t=>i.getUint8(s+16+1+t)));return this.debug(`  [${r.map((t=>"0"+t.toString(8))).join(", ")}] [${n}]`),this.termios.flags=r,this.core.stdin.blocking=n[6]>0,this.core.proc.emit("syscall",{func:"ioctl:tty",data:{fd:t,when:e,flags:r}}),0}tgetent(t,e){return this.debug(`tgetent(_, '${this.core.proc.userGetCString(e)}')`),1}tty_ioctl(t,e,s){if(console.warn("tty_ioctl",t,e,s),1==t){var i=this.core.proc.mem,r=this.termios.win;switch(e){case _.TIOCGWINSZ:for(let t=0;t<r.length;t++)i.setUint16(s+2*t,r[t],!0);break;case _.TIOCSWINSZ:var n=r.map(((t,e)=>i.getUint16(s+2*e)));this.core.proc.emit("syscall",{func:"ioctl:tty",data:{fd:t,request:e,win:n}})}}}}var _;function v(t,e){return e.reduce(((e,s)=>Object.assign(e,{[s]:t[s].bind(t)})),{})}function w(t){return[...Array(t).keys()]}!function(t){t[t.TCSETFL=1]="TCSETFL",t[t.TIOCGWINSZ=21523]="TIOCGWINSZ",t[t.TIOCSWINSZ=21524]="TIOCSWINSZ"}(_||(_={}));var b=s(2055);const y={debug:t=>{}};for(let t of["signal","raise","pipe","dup","dup2","dup3","execv","execl","execvp","execlp","getpwnam","getpwnam_r","getpwent","tcsetpgrp","kill","killpg","fork","realpath","getpid","getpgid","setpgid","getpgrp","setpgrp","issetugid","strsignal","wait4","waitpid","getuid","geteuid","getgid","getegid","getsid","setegid","seteuid","setgid","setuid","setsid","umask","getrlimit","setrlimit","getpriority","setpriority","sigfillset","sigprocmask","sigsetmask","siginterrupt","sigaltstack","sigwait","sigpending","getppid","tcgetpgrp","gethostname","tzset","flockfile","ftrylockfile","funlockfile","getpwuid","getpwuid_r","setpwent","endpwent","getgrgid","setreuid","setregid","strmode","acl_get_file","acl_free","acl_get_entry","fchdir","chown","fchown","lchown","fchownat","chmod","fchmod","fchmodat","lchmod","chflags","fchflags","lchflags","chroot","getgroups","utimes","futimes","lutimes","clock_gettime","clock_settime","alarm","system","mkfifo","mkstemp","mkstemps","mkostemp","mkostemps","tmpfile","settimeofday","bsd_signal","ttyname","ttyname_r","ctermid_r","socket","connect","popen","pclose","sync","nice","errx","vwarnx","posix_spawn","posix_spawnp","posix_spawnattr_init","posix_spawnattr_destroy","posix_spawnattr_setflags","posix_spawnattr_setsigmask","posix_spawn_file_actions_init","posix_spawn_file_actions_destroy","posix_spawn_file_actions_addopen","posix_spawn_file_actions_addclose","posix_spawn_file_actions_adddup2","pthread_mutex_init","pthread_mutex_lock","pthread_cond_timedwait","pthread_cond_signal","pthread_mutex_unlock","pthread_cond_destroy","pthread_mutex_destroy","pthread_cond_wait","pthread_cond_init","pthread_attr_init","pthread_attr_setstacksize","pthread_attr_destroy","pthread_create","pthread_detach","pthread_self","pthread_kill","pthread_exit","pthread_mutex_trylock","pthread_key_create","pthread_key_delete","pthread_setspecific","pthread_getspecific","pthread_sigmask","pthread_attr_getscope","pthread_attr_setscope","posix_spawnattr_setpgroup","posix_spawnattr_setsigdefault","tgetent","tgetflag","tgetnum","tgetstr","tgoto","tputs","cfgetospeed","cfgetispeed","cfsetospeed","cfsetispeed","tcsendbreak","tcdrain","tcflush","tcflow","tcgetsid","login","login_tty","logout","logwtmp","opendev","openpty","fparseln","forkpty","pidlock","ttylock","ttyunlock","ttyaction","ttymsg"])y[t]=function(){y.debug(`stub for ${t} [${[...arguments]}]`)};const S=y;var k=s(4293);const x={0:[0,97,115,109,1,0,0,0,1,5,1,96,0,1,127,2,16,1,3,101,110,118,8,100,101,108,101,103,97,116,101,0,0,3,2,1,0,7,8,1,4,103,108,117,101,0,1,10,6,1,4,0,16,0,11],1:[0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,2,16,1,3,101,110,118,8,100,101,108,101,103,97,116,101,0,0,3,2,1,0,7,8,1,4,103,108,117,101,0,1,10,8,1,6,0,32,0,16,0,11],2:[0,97,115,109,1,0,0,0,1,7,1,96,2,127,127,1,127,2,16,1,3,101,110,118,8,100,101,108,101,103,97,116,101,0,0,3,2,1,0,7,8,1,4,103,108,117,101,0,1,10,10,1,8,0,32,0,32,1,16,0,11],3:[0,97,115,109,1,0,0,0,1,8,1,96,3,127,127,127,1,127,2,16,1,3,101,110,118,8,100,101,108,101,103,97,116,101,0,0,3,2,1,0,7,8,1,4,103,108,117,101,0,1,10,12,1,10,0,32,0,32,1,32,2,16,0,11],4:[0,97,115,109,1,0,0,0,1,9,1,96,4,127,127,127,127,1,127,2,16,1,3,101,110,118,8,100,101,108,101,103,97,116,101,0,0,3,2,1,0,7,8,1,4,103,108,117,101,0,1,10,14,1,12,0,32,0,32,1,32,2,32,3,16,0,11],5:[0,97,115,109,1,0,0,0,1,10,1,96,5,127,127,127,127,127,1,127,2,16,1,3,101,110,118,8,100,101,108,101,103,97,116,101,0,0,3,2,1,0,7,8,1,4,103,108,117,101,0,1,10,16,1,14,0,32,0,32,1,32,2,32,3,32,4,16,0,11],6:[0,97,115,109,1,0,0,0,1,11,1,96,6,127,127,127,127,127,127,1,127,2,16,1,3,101,110,118,8,100,101,108,101,103,97,116,101,0,0,3,2,1,0,7,8,1,4,103,108,117,101,0,1,10,18,1,16,0,32,0,32,1,32,2,32,3,32,4,32,5,16,0,11],7:[0,97,115,109,1,0,0,0,1,12,1,96,7,127,127,127,127,127,127,127,1,127,2,16,1,3,101,110,118,8,100,101,108,101,103,97,116,101,0,0,3,2,1,0,7,8,1,4,103,108,117,101,0,1,10,20,1,18,0,32,0,32,1,32,2,32,3,32,4,32,5,32,6,16,0,11],8:[0,97,115,109,1,0,0,0,1,13,1,96,8,127,127,127,127,127,127,127,127,1,127,2,16,1,3,101,110,118,8,100,101,108,101,103,97,116,101,0,0,3,2,1,0,7,8,1,4,103,108,117,101,0,1,10,22,1,20,0,32,0,32,1,32,2,32,3,32,4,32,5,32,6,32,7,16,0,11],9:[0,97,115,109,1,0,0,0,1,14,1,96,9,127,127,127,127,127,127,127,127,127,1,127,2,16,1,3,101,110,118,8,100,101,108,101,103,97,116,101,0,0,3,2,1,0,7,8,1,4,103,108,117,101,0,1,10,24,1,22,0,32,0,32,1,32,2,32,3,32,4,32,5,32,6,32,7,32,8,16,0,11]};class A{constructor(t){this.core=t}preload(t,e,s){if(this.dylibTable||(this.dylibTable=new I.Table),!this.dylibTable.def.has(t))return this.core.fetchCompile(e).then((i=>{this.dylibTable.def.set(t,new I.Def(i,s,{path:t,uri:e}))}))}get import(){return T(this,["dlopen","dlsym","dlclose"])}get extlib(){return T(this,["dlerror_get"])}dlopen(t,e){var s=this.userGetCString(t).toString("utf-8");if(this.core.trace.syscalls(`dlopen("${s}", ${e})`),!this.dylibTable)return 0;var i=this.dylibTable.def.get(s);if(i){var r=i.instantiate(this.core),n=this.dylibTable.ref.size+1;return this.dylibTable.ref.set(n,{def:i,instance:r}),n}return 0}dlsym(t,e){var s,i,r=this.userGetCString(e).toString("utf-8");this.core.trace.syscalls(`dlsym(${t}, "${r}")`);var n=this.dylibTable.ref.get(t);if(n){var o=n.instance.exports[r];if(o&&o instanceof Function)return this.allocateFunc(o);var a=null===(i=null===(s=n.def.reloc)||void 0===s?void 0:s.js)||void 0===i?void 0:i[r],h=a&&this.allocateDelegate(a);if(void 0!==h)return h}return 0}dlclose(t){}dlerror_get(t){return this.userCStringMalloc("not found\0",t)}allocateFunc(t){var e=this.core.proc.funcTable.grow(1);return this.core.proc.funcTable.set(e,t),e}allocateDelegate(t){var e=x[t.length];if(e){var s=new WebAssembly.Module(new Uint8Array(e)),i=new WebAssembly.Instance(s,{env:{delegate:t}});return this.allocateFunc(i.exports.glue)}console.warn(`cannot delegate function with ${t.length} arguments:`,t)}userGetCString(t){return this.core.proc.userGetCString(t)}userCStringMalloc(t,e){return this.core.proc.userCStringMalloc(t,e)}}var I;!function(t){t.Table=class{constructor(){this.def=new Map,this.ref=new Map}},t.Def=class{constructor(t,e={},s={}){this.stackSize=65536,this.memBlocks=10,this.tblSize=1024,this.module=t,this.reloc=e,this.metadata=s}instantiate(t){var e=t.wasi.memory.buffer.byteLength+this.stackSize,s=t.proc.funcTable.length;t.wasi.memory.grow(this.memBlocks),t.proc.funcTable.grow(this.tblSize);var i=this.globals(this.module,t.wasm.instance),r=new WebAssembly.Instance(this.module,{env:{memory:t.wasi.memory,table:t.proc.funcTable,__indirect_function_table:t.proc.funcTable,__memory_base:e,__table_base:s,__stack_pointer:this._mkglobal(e),stackSave:()=>e,stackRestore:()=>{},...this.relocTable(this.module,t.wasm.instance,t.proc.import),...this.emglobals(this.module,e,t.wasm.instance,(()=>r))},...i,wasik_ext:t.proc.extlib});this.globalsInit(r,e,i["GOT.mem"]||{});var n=r.exports.__post_instantiate;n instanceof Function&&n();var o=r.exports.__wasm_call_ctors;return o instanceof Function&&o(),r}relocTable(t,e,s){var i,r=WebAssembly.Module.imports(t),n={};for(let t of r)if("env"==t.module&&"function"===t.kind){var o=(null===(i=this.reloc.js)||void 0===i?void 0:i[t.name])||e.exports[C[t.name]||t.name]||s[t.name];o instanceof Function?n[t.name]=o:(console.warn("unresolved symbol:",t,"\nin",this.metadata),n[t.name]=()=>0)}return n}globals(t,e){var s,i,r=WebAssembly.Module.imports(t),n={};for(let t of r)if("global"===t.kind&&t.module.match(O)){var o=e.exports[t.name];null!==(s=n[i=t.module])&&void 0!==s||(n[i]={}),n[t.module][t.name]=this._mkglobal(o instanceof WebAssembly.Global?o.value:void 0)}return n}globalsInit(t,e,s){for(let r in s){var i=t.exports[r];i instanceof WebAssembly.Global&&(s[r].value=e+i.value)}}emglobals(t,e,s,i){var r=WebAssembly.Module.imports(t),n=WebAssembly.Module.exports(t),o={};for(let t of r)if("function"===t.kind&&t.name.startsWith("g$")){let r,a=t.name.slice(2);(r=s.exports[a])?o[t.name]=()=>r:(r=n.find((t=>t.name==a)))&&(o[t.name]=()=>{return t=a,e+ +i().exports[t];var t})}return o}_mkglobal(t=3735928559){return new WebAssembly.Global({value:"i32",mutable:!0},t)}}}(I||(I={}));const O=/^GOT[.]/,C={fiprintf:"fprintf"};function T(t,e){return e.reduce(((e,s)=>Object.assign(e,{[s]:t[s].bind(t)})),{})}const F={O_RDONLY:0,O_WRONLY:1,O_RDWR:2,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:512,O_EXCL:2048,O_NOCTTY:131072,O_TRUNC:1024,O_APPEND:8,O_DIRECTORY:1048576,O_NOFOLLOW:256,O_SYNC:128,O_DSYNC:4194304,O_SYMLINK:2097152,O_NONBLOCK:4,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_COPYFILE_EXCL:1,COPYFILE_EXCL:1},N=new class{constructor(){this.constants=F}strmode(t){let e="";return e+={[F.S_IFDIR]:"d",[F.S_IFCHR]:"c",[F.S_IFBLK]:"b",[F.S_IFREG]:"-",[F.S_IFLNK]:"l",[F.S_IFSOCK]:"s",[F.S_IFIFO]:"p"}[t&F.S_IFMT]||"?",e+=t&F.S_IRUSR?"r":"-",e+=t&F.S_IWUSR?"w":"-",e+=t&F.S_IXUSR?"x":"-",e+=t&F.S_IRGRP?"r":"-",e+=t&F.S_IWGRP?"w":"-",e+=t&F.S_IXGRP?"x":"-",e+=t&F.S_IROTH?"r":"-",e+=t&F.S_IWOTH?"w":"-",e+=t&F.S_IXOTH?"x":"-",e}};var W,B;W="undefined"!=typeof TextEncoder?t=>(new TextEncoder).encode(t):t=>Buffer.from(t),B="undefined"!=typeof TextDecoder?t=>(new TextDecoder).decode(t):t=>Buffer.from(t).toString("utf-8");class $ extends n.EventEmitter{constructor(t,e={}){super(),this.core=t,this.opts=e,this.sigvec=new j,this.sigvec.on("signal",(t=>this.emit("syscall",{func:"signal",data:t}))),this.childq=new u({data:new Uint32Array(new q(512))}),this.childset=new Set,this.dyld=new A(t),this.pending=[]}init(){const t=this.newfd()+1,e={real:t,rights:M,filetype:b.WASI_FILETYPE_DIRECTORY,path:".",fakePath:"."};this.core.wasi.FD_MAP.set(R,e),this.core.wasi.FD_MAP.set(t,e),this.core.wasmFs.fs.writeFileSync("/dev/null","")}get import(){return this.sigvec.debug=this.debug,this.funcTable||(this.funcTable=new WebAssembly.Table({initial:this.opts.funcTableSz||1024,element:"anyfunc"})),{...S,__indirect_function_table:this.funcTable,...U(this,["geteuid","strmode","__control_setjmp","__control_setjmp_with_return","setjmp","longjmp","sigsetjmp","siglongjmp","vfork","__control_fork","wait","wait3","execve","sigkill","sigsuspend","sigaction","getpagesize","posix_spawn"]),...this.dyld.import}}get extlib(){return{...U(this,["trace","sorry","dupfd","progname_get","login_get"]),...this.dyld.extlib}}get path(){return{...r(),resolve:(t,...e)=>("."==t&&(t=this.core.env.PWD),r().resolve(t||"/",...e))}}get mem(){return this.core.wasi.refreshMemory(),this.core.wasi.view}get membuf(){return k.Buffer.from(this.core.wasi.memory.buffer)}sorry(){for(var t;t=this.pending.pop();t());}getenv_all(){var t=this.core.wasm.instance.exports.wasik_environ;return"function"==typeof t?this.parse_env(t()):{}}parse_env(t){var e={};for(let s of this.userGetCStrings(t))this._parse_envvar(s,e);return e}_parse_envvar(t,e){try{var s=(new TextDecoder).decode(t),i=s.match(/^(.*?)=(.*)$/);i?e[i[1]]=i[2]:console.warn(`invalid envvar? '${s}'`)}catch(t){console.warn("parse_env",t)}}progname_get(t){var e=this.core.argv[0]+"\0";return this.userCStringMalloc(e,t)}login_get(t){return this.userCStringMalloc("user\0",t)}geteuid(){return 0}trace(t){var e=this.userGetCString(t);this.core.trace.user(e)}realpath(t,e){var s=this.userGetCString(t);if(0===e)throw"realpath(0): not implemented";let i=r().resolve(this.core.env.PWD,B(s))+"\0";if(i.length>E)throw{errno:1,code:"ERANGE"};return this.membuf.write(i,e),e}newfd(t=0){var e=Math.max(...this.core.wasi.FD_MAP.keys());return Math.max(t,e+1)}dupfd(t,e,s){this.core.trace.syscalls(`dupfd(${t}, ${e}, ${s}`);var i=this.core.wasi.FD_MAP.get(t);if(!i)return-1;var r=this.newfd(e);return this.core.wasi.FD_MAP.set(r,this.dupdesc(i)),r}dupdesc(t){var e=this.core.wasmFs.volume.openSync("/","r"),s=this.core.wasmFs.volume.fds;return s[e]=s[t.real],Object.assign({},t,{real:e})}strmode(t,e){let s=N.strmode(t)+"\0";this.membuf.write(s,e)}__control_setjmp(t,e){this.debug(`__control_setjmp [${t}, ${e}]`),this.mem.setUint32(t,0);let s=this.blockImpl(e),i=0;try{for(;;)try{return s(i)}catch(e){if(this.debug(`setjmp caught ${JSON.stringify(e)}`),!(e instanceof G&&e.env==t))throw e;i=e.val}}finally{this.debug("__control_setjmp exiting")}}__control_setjmp_with_return(t,e){return this.__control_setjmp(t,e)}setjmp(t){return console.warn("setjmp",t),0}longjmp(t,e){throw this.debug(`longjmp [${t}] ${e}`),new G(t,e)}sigsetjmp(t,e){return this.core.trace.syscalls(`sigsetjmp(${t}, ${e})`),0}siglongjmp(t,e){this.longjmp(t,e)}vfork(){this.core.trace.syscalls("vfork()");var t=Math.max(0,...this.childset)+1;return this.childset.add(t),this.onJoin=e=>{if(!(e instanceof P))throw e;{let s=e;this.emit("syscall",{func:"spawn",data:{pid:t,execv:s.copy(),env:this.getenv_all()}})}},t}__control_fork(t,e,s){let i=this.blockImpl(s);try{i(t),this.onJoin&&this.onJoin(null)}catch(t){this.onJoin&&this.onJoin(t)}this.onJoin=null,i(e)}execve(t,e,s){throw this.core.trace.syscalls(`execv(${t}, ${e}, ${s})`),new P(B(this.userGetCString(t)),this.userGetCStrings(e),this.userGetCStrings(s))}posix_spawn(t,e,s,i,r,n){var o=B(this.userGetCString(e));this.core.trace.syscalls(`posix_spawn(${t}, "${o}", ${s}, ${i}, ...})`);var a=new P(o,this.userGetCStrings(r),this.userGetCStrings(n)),h=Math.max(0,...this.childset)+1;return this.emit("syscall",{func:"spawn",data:{pid:h,execv:a,env:this.core.env}}),this.mem.setUint32(t,h,!0),0}wait(t){return this.core.trace.syscalls(`wait(${t})`),this.waitBase(t)}wait3(t,e,s){return this.core.trace.syscalls(`wait3(${t}, ${e}, ${s})`),this.waitBase(t)}waitBase(t){var e=this.childq.dequeue(),s=this.childq.dequeue();return this.debug(`  -> ${e}`),0!==t&&this.mem.setUint32(t,s<<8,!0),e}userGetCString(t){if(0==t)return null;let e=k.Buffer.from(this.core.wasi.memory.buffer);return e.slice(t,e.indexOf(0,t))}userGetCStrings(t){if(0==t)return null;let e=[];for(;;){let s=this.mem.getUint32(t,!0);if(0===s)break;e.push(this.userGetCString(s)),t+=4}return e}userCStringMalloc(t,e){return this.pending.push((()=>{let s=this.mem.getUint32(e,!0);this.membuf.write(t,s)})),t.length}blockImpl(t){let e=this.funcTable.get(this.mem.getUint32(t+12,!0));return(...s)=>e(t,...s)}sigkill(t){this.sigvec.send(t)}sigsuspend(){this.sigvec.receive()}sigaction(t,e,s){if(this.core.trace.syscalls(`sigaction(${t}, ${e}, ${s})`),0!=e){var i=this.mem.getUint32(e,!0),r=this.funcTable.get(i);this.core.trace.syscalls(" --\x3e",i,r),this.sigvec.handlers[t]=r}0!=s&&this.mem.setUint32(s,0)}getpagesize(){return 4096}}const R=-100,M={base:b.RIGHTS_ALL,inheriting:b.RIGHTS_ALL};class j extends n.EventEmitter{constructor(t={}){super(),this.wait=t.wait||new Int32Array(new q(4*L)),this.handlers=Array(L)}static from(t){return new j(t)}to(){return{wait:this.wait}}send(t){a()(0<t&&t<L),Atomics.add(this.wait,0,1),Atomics.add(this.wait,t,1),Atomics.notify(this.wait,0,1)}receive(t){return this._snapshot||(this._snapshot=new Int32Array(L)),Atomics.wait(this.wait,0,Atomics.load(this.wait,0)),this.sweep(t),-1}sweep(t){for(let e=1;e<L;e++)if(!t||t.includes(e)){let t=this.handlers[e];t&&this._snapshot[e]<this.wait[e]&&(this.debug("calling",t),t(e)),this._snapshot[e]=this.wait[e]}}}const E=256,L=20;class P{constructor(t,e,s){this.prog=t,this.argv=e,this.envp=s}copy(){var t=t=>t.map((t=>k.Buffer.from(t)));return new P(this.prog,t(this.argv),t(this.envp))}}class G{constructor(t,e){this.env=t,this.val=e}}const q="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;function U(t,e){return e.reduce(((e,s)=>Object.assign(e,{[s]:t[s].bind(t)})),{})}c.WASI.defaultBindings=h.jU||h.n2?s(1311).Z:s(9647).Z;class z extends n.EventEmitter{constructor(t={}){super(),this.debug=J,this.trace={user:J,syscalls:J},this.opts=t=Object.assign({},D,t),this.stdin=t.stdin?new f:null,this.wasmFs=new d.Yn,this.populateRootFs(),this.proc=new $(this,t.proc),this.tty=t.tty?new m(this):null,this.cached=!1!==t.cacheBins?new Map:null,this.init()}initTraces(){var t;this.opts.debug&&(this.debug=this._debugPrint(),this.trace.user=this._tracePrint()),(null===(t=this.opts.trace)||void 0===t?void 0:t.syscalls)&&(this.trace.syscalls=this._tracePrintAny()),this.tty&&(this.tty.debug=(...t)=>this.debug(...t)),this.proc.debug=(...t)=>this.debug(...t),S.debug=this.debug}init(){this.argv=["."],this.env=this.initialEnv(),this.wasi=new c.WASI({args:this.argv,env:this.env,bindings:{...c.WASI.defaultBindings,exit:t=>{throw new H(t)},fs:this.wasmFs.fs,path:this.proc.path},preopens:{"/":"/"},...this.extraWASIConfig()}),this.exited=!1,this.registerStdio(),this.proc.init();let t=this.opts.tty;if(t){var e="number"==typeof t?[t]:"boolean"==typeof t?[0,1,2]:t;this.tty.fds=e;for(let t of e)this.tty.makeTty(t)}}configure(t){Object.assign(this.opts,t)}reset(){this.stdin&&this.stdin.reset(),this.init()}async start(t,e,s){this.exited&&this.reset(),e&&this.argv.splice(0,1/0,...e),s&&Object.assign(this.env,s),this.proc.opts=this.opts.proc||{},this.initTraces();var i=await this.fetchCompile(t),r=await WebAssembly.instantiate(i,this.getImports(i));this.wasm={module:i,instance:r};try{return this.wasi.start(this.wasm.instance),0}catch(t){if(t instanceof H)return t.code;throw t}finally{this.exited=!0}}get fs(){return this.wasmFs.fs}async fetch(t){switch(this.opts.fetchMode){case"browser":const e=await fetch(t);return new Uint8Array(await e.arrayBuffer());case"fs":return(0,s(5747).readFileSync)(t);default:a()(!1,`unknown fetch mode '${this.opts.fetchMode}'`)}}async fetchCompile(t){return s=t,i=async t=>{var e=await this.fetch(t);return WebAssembly.compile(e)},(e=this.cached)?function(t,e,s){let i=t.get(e);return i||(i=s(e),t.set(e,i)),i}(e,s,i):i(s);var e,s,i}getImports(t){var e,s;return{...this.wasi.getImports(t),wasik_ext:{...this.proc.extlib,...null===(e=this.tty)||void 0===e?void 0:e.extlib},env:{...this.proc.import,...null===(s=this.tty)||void 0===s?void 0:s.import}}}share(){return{stdin:this.stdin.to(),tty:this.tty.to(),sigvec:this.proc.sigvec.to(),childq:this.proc.childq.to()}}emitWrite(t,e){return this.emit("stream:out",{fd:t,data:e}),e.length}initialEnv(){return this.opts.env?Object.assign({},this.opts.env):this.defaultEnv()}defaultEnv(){return{PATH:"/bin",PWD:"/home"}}extraWASIConfig(){let t=this.opts;return{traceSyscalls:t.trace&&t.trace.syscalls}}registerStdio(){var t=this.wasmFs.volume;if(!(t.fds[0]&&t.fds[1]&&t.fds[2])){t.releasedFds=[0,1,2];const e=t.openSync("/dev/stderr","w"),s=t.openSync("/dev/stdout","w"),i=t.openSync("/dev/stdin","r");a()(0==i&&1==s&&2==e)}this.stdin&&(t.fds[0].read=this.stdin.read.bind(this.stdin)),t.fds[1].write=t=>this.emitWrite(1,t),t.fds[2].write=t=>this.emitWrite(2,t)}mountFs(t){t.fromJSON(this.wasmFs.volume.toJSON()),this.wasmFs.volume=t,this.wasmFs.fs=(0,l.createFsFromVolume)(t),this.init()}populateRootFs(){this.wasmFs.fs.mkdirSync("/home"),this.wasmFs.fs.mkdirSync("/bin")}_debugPrint(){return global.process?(...t)=>this.emitWrite(2,W(t.join(" ")+"\n")):console.log}_tracePrint(){return global.process?t=>this.emitWrite(2,t):t=>console.warn("[trace]",B(t),t)}_tracePrintAny(){return global.process?(...t)=>this.emitWrite(2,W(t.toString())):(...t)=>console.warn("[trace]",...t)}}const D={stdin:!0,fetchMode:h.jU||h.n2?"browser":"fs"},J=()=>{};class H{constructor(t){this.code=t}}var X,K=s(6898),Y=s(1172);class Z extends l.Volume{constructor(t={}){let e;super({Node:class{constructor(t,s){return new Q(e,t,s)}},Link:tt}),this.dev=V.from(t.dev),e=this;var s=this.root.getNode();s.vol=this,s._link=this.root,this.debug=()=>{}}static from(t){return new Z(t)}to(){return{dev:this.dev.to()}}writeBlob(t,e){var s=this.openSync(t,l.fs.constants.O_CREAT),i=this.fds[s].node,r=this.dev.allocBlob(e.length);r.set(e,0),i.setBlob(r),this.closeSync(s)}createLink(t,e,s,i){const r=super.createLink(t,e,s,i);return t&&this.debug("+ created link",t.ino,e,r.ino),r.push(),r}deleteLink(t){this.debug("deleted link",t.parent.ino,t.getName(),t.ino);var e=t.parent,s=super.deleteLink(t);return e.push(),s}createNode(t=!1,e){if(!this.dev)return super.createNode(t,e);const s=new this.props.Node(this.dev.alloc(),e);return t&&s.setIsDirectory(),this.inodes[s.ino]=s,s.push(),s}getNodeShared(t){return this.inodes[t]||this._fetchNode(t)}createSymlink(t,e){this.symlinkSync("",e);var s=this.getLink((0,K.filenameToSteps)(e)),i=t.split("/");return""==i[0]?i.splice(0,1):i.splice(0,0,"."),s.getNode().makeSymlink(i),s}getResolvedLink(t){let e="string"==typeof t?(0,K.filenameToSteps)(t):t,s=this.root;for(let t=0;t<e.length;){const i=e[t],r=s.getChild(i);if(!r)return null;const n=r.getNode();if(n.isSymlink()){if(e=n.symlink.concat(e.slice(t+1)),t=0,"."!==e[0]){s=this.root;continue}}else s=r;t++}return s}_fetchNode(t){var e=new this.props.Node(t);return this.inodes[t]=e,e}}class V{constructor(t={}){this.raw=t.raw||new SharedArrayBuffer(t.size||1<<20),this.blockSize=t.blockSize||1024,this.blockCount=this.raw.byteLength/this.blockSize,this.bitset=t.bitset||new Uint8Array(new SharedArrayBuffer(this.blockCount)),this.cursors=t.cursors||new Uint32Array(new SharedArrayBuffer(12)),t.cursors||(this.blockCursor=2,this.boundaryCursor=2,this.blobCursor=this.raw.byteLength)}static from(t){return new V(t)}to(){return{raw:this.raw,blockSize:this.blockSize,bitset:this.bitset,cursors:this.cursors}}get(t){var e=t*this.blockSize;return new Uint8Array(this.raw,e,this.blockSize)}isFree(t){return 0==Atomics.load(this.bitset,t)}get blockCursor(){return this.cursors[0]}set blockCursor(t){this.cursors[0]=t}get boundaryCursor(){return this.cursors[1]}set boundaryCursor(t){this.cursors[1]=t}get blobCursor(){return this.cursors[2]}set blobCursor(t){this.cursors[2]=t}alloc(){let t=this.blobCursor/this.blockSize;for(let e=this.blockCursor;e<t;e++)if(0==this.bitset[e]&&0==Atomics.compareExchange(this.bitset,e,0,1))return this.blockCursor=e,this.boundaryCursor=Math.max(this.boundaryCursor,e+1),e;throw new Error("no space left on device")}allocBlob(t){var e=this.blobCursor-t;if(e<this.boundaryCursor*this.blockSize)throw new Error("no space left on device");return this.blobCursor=e,this.getBlob(e,t)}getBlob(t,e){var s=new Uint8Array(this.raw,t,e);return Object.setPrototypeOf(s,Buffer.prototype),s}readText(t,e=0){var s=this.get(t);return s=s.slice(e,s.indexOf(0,e)),{buf:new TextDecoder("utf-8").decode(s),size:s.length+1}}read(t,e=0,s){var i=this.get(t).slice(e,s>=0?e+s:void 0);return{buf:i,size:i.length}}readInto(t,e,s,i,r){var n=this.get(t).subarray(e,e+s);return i.set(n,r),n.length}writeText(t,e,s=0){var i=Buffer.from(e+"\0","utf-8");if(i.length+s>this.blockSize)throw new Error(`inode text overflow (block=${t}, length=${i.length})`);return this.write(t,i,s)}write(t,e,s=0){return s+e.length>this.blockSize&&(e=e.subarray(0,this.blockSize-s)),this.get(t).set(e,s),e.length}}class Q extends Y.Node{constructor(t,e,s){super(e,s),this.vol=t,this.ver=0,this.isBlob=!1,this._link=null}setModeProperty(t){super.setModeProperty(t),this.ver++,this.push()}getLink(t,e){return this._link||(a()(t&&e),this._link=new tt(this.vol,t,e),this._link.setNode(this)),this._link}setBlob(t){this.buf=t,this.isBlob=!0,this.touch()}touch(){super.touch(),this.ver++,this.push()}del(){super.del()}push(){if(this.vol&&this.vol.dev){var t=this.vol.dev.get(this.ino),e={p:this.perm,m:this.mode,v:this.ver},s=this.buf;0!=t[0]&&(e=Object.assign(this._read().header,e)),s&&(e.z=s.length),this.isBlob&&(e.blob=[s.byteOffset],s=void 0),this.symlink&&(e.symlink=this.symlink),this.vol.debug("+ push node",this.ino,e);var i=this._write(e,s);this._writeTrail(s,i)}}pull(){if(this.vol&&0!=this.vol.dev.get(this.ino)[0]){var{header:t,rdc:e}=this._read();if(this.vol.debug("- pull node",this.ino,t),this.perm=t.p,this.mode=t.m,this.symlink=t.symlink,this.symlink&&console.log("symlink",this.symlink),this.ver!=t.v&&(this.ver=t.v,t.z>=0))if(t.blob)this.buf=this.vol.dev.getBlob(t.blob[0],t.z),this.isBlob=!0;else{var s=Buffer.alloc(t.z),i=this.vol.dev.readInto(this.ino,e,t.z,s,0);t.n>0&&this._readTrail(s,i),this.buf=s,this.isBlob=!1}}}_read(){var{buf:t,size:e}=this.vol.dev.readText(this.ino);return{header:JSON.parse(t),rdc:e}}_write(t,e){var s=this._writeJson(t||{});if(e&&s+e.length>this.vol.dev.blockSize){var i=this._next(t).ino;s=this._writeJson(Object.assign({},t,{n:i}))}return e?this.vol.dev.write(this.ino,e,s):0}_writeJson(t){return this.vol.dev.writeText(this.ino,JSON.stringify(t))}_writeTrail(t,e){for(var s=this;t&&e<t.length;)t=t.subarray(e),e=(s=s._next())._write(null,t),a()(e>0)}_readTrail(t,e){for(var s=this;e<t.length;){s=s._next();var{header:i,rdc:r}=s._read();if(r=this.vol.dev.readInto(s.ino,r,t.length-e,t,e),a()(r>0),e+=r,!(i.n>=0))break}a()(e==t.length)}_next(t){return t||(t=this._read().header),t.n>=0?this.vol.getNodeShared(t.n):this.vol.createNode()}}class tt extends Y.Link{constructor(t,e,s){return super(t,e,s),this.ver=0,this._dirty=!1,new Proxy(this,new X.LinkHandler)}createChild(t,e=this.vol.createNode()){this._dirty=!0;const s=new tt(this.vol,this,t);return s.setNode(e),this.setChild(t,s),s}setChild(t,e){return this._dirty=!0,e=super.setChild(t,e),this.touch(),e}deleteChild(t){this._dirty=!0,super.deleteChild(t),this.touch()}touch(){this.vol.getNodeShared(this.ino).ver++,this.push()}setNode(t){super.setNode(t),t._link=this}getNode(){const t=this.node;return a()(t,"LinkSharedVolume.node is unset"),t.pull(),t}push(){if(this.vol.dev){var t={};for(let[e,s]of Object.entries(this.children))t[e]={ino:s.ino};var e=this.getNode(),s=JSON.stringify(t);this.vol.debug("+ push link",this.ino,s),e.buf=Buffer.from(s),e.ver++,e.push(),this.ver=e.ver,this._dirty=!1}}pull(){if(0!=this.vol.dev.get(this.ino)[0]){var t=this.getNode();if(t.pull(),t.isDirectory()&&t.buf&&t.ver!==this.ver){var e=JSON.parse(t.buf.toString("utf-8"));this.vol.debug("- pull link",this.ino,e);var s={};for(let[t,i]of Object.entries(e||{}))if("number"==typeof i.ino){let e=this.vol.getNodeShared(i.ino);s[t]=e.getLink(this,t)}this.children=s,this.ver=t.ver,this._dirty=!1}}}}let et,st,it;if(function(t){t.LinkHandler=class{get(t,e){return"children"===e&&t.vol.dev&&!t._dirty&&t.pull(),t[e]}},t.LinkChildren=class{constructor(t){this.link=t}getOwnPropertyDescriptor(t,e){return this.link.pull(),t.hasOwnProperty(e)?{configurable:!0,enumerable:!0}:void 0}get(t,e){return this.link.pull(),t[e]}set(t,e,s){return t[e]=s,!0}}}(X||(X={})),h.n2)et=self.Worker,st=self.postMessage,it=t=>addEventListener("message",t);else if(h.UG){const t=s(5013);class e{constructor(e){this.thread=new t.Worker(e)}addEventListener(t,e){this.thread.on(t,(t=>{e({data:t})}))}postMessage(t){this.thread.postMessage(t)}static onMessage(e){t.parentPort.on("message",(t=>{e({data:t})}))}static postMessage(e){t.parentPort.postMessage(e)}}et=e,it=e.onMessage,st=e.postMessage}const rt=new z({tty:!0});st(rt.share()),rt.on("stream:out",(t=>st(t))),rt.tty.on("data",(t=>st({event:"tty:data",arg:t}))),rt.proc.on("syscall",(t=>st({event:"syscall",arg:t}))),it((async t=>{if(t.data.upload)for(let e in t.data.upload)rt.wasmFs.fs.mkdirpSync(r().dirname(e)),rt.wasmFs.fs.writeFileSync(e,t.data.upload[e]);if(t.data.volume&&rt.mountFs(Z.from(t.data.volume)),t.data.dyld)for(let e of t.data.dyld.preload||[])rt.proc.dyld.preload(e.name,e.uri,e.reloc);if(t.data.exec){let e=t.data.exec,s=t.data.opts&&t.data.opts.argv,i=t.data.opts&&t.data.opts.env;rt.configure(t.data.opts);try{let t=await rt.start(e,s,i);st({event:"exit",arg:{code:t}})}catch(t){st({event:"error",arg:t})}}})),self.core=rt},2357:t=>{t.exports=require("assert")},4293:t=>{t.exports=require("buffer")},6417:t=>{t.exports=require("crypto")},8614:t=>{t.exports=require("events")},5747:t=>{t.exports=require("fs")},5622:t=>{t.exports=require("path")},1765:t=>{t.exports=require("process")},2413:t=>{t.exports=require("stream")},3867:t=>{t.exports=require("tty")},8835:t=>{t.exports=require("url")},1669:t=>{t.exports=require("util")},5013:t=>{t.exports=require("worker_threads")}},r={};function n(t){var e=r[t];if(void 0!==e)return e.exports;var s=r[t]={exports:{}};return i[t].call(s.exports,s,s.exports,n),s.exports}n.m=i,n.x=()=>{var t=n.O(void 0,[738],(()=>n(7581)));return n.O(t)},t=[],n.O=(e,s,i,r)=>{if(!s){var o=1/0;for(c=0;c<t.length;c++){for(var[s,i,r]=t[c],a=!0,h=0;h<s.length;h++)(!1&r||o>=r)&&Object.keys(n.O).every((t=>n.O[t](s[h])))?s.splice(h--,1):(a=!1,r<o&&(o=r));if(a){t.splice(c--,1);var l=i();void 0!==l&&(e=l)}}return e}r=r||0;for(var c=t.length;c>0&&t[c-1][2]>r;c--)t[c]=t[c-1];t[c]=[s,i,r]},n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.f={},n.e=t=>Promise.all(Object.keys(n.f).reduce(((e,s)=>(n.f[s](t,e),e)),[])),n.u=t=>t+".index.js",n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s={34:1},n.O.require=t=>s[t],n.f.require=(t,e)=>{s[t]||(t=>{var e=t.modules,i=t.ids,r=t.runtime;for(var o in e)n.o(e,o)&&(n.m[o]=e[o]);r&&r(n);for(var a=0;a<i.length;a++)s[i[a]]=1;n.O()})(require("./"+n.u(t)))},e=n.x,n.x=()=>(n.e(738),e());var o=n.x();module.exports=o})();